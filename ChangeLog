2005-05-21  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (parse_options): New option: --signature.
	(ImapWeb::read_signature_file): New method.
	- Applied a patch by Masanori Hanawa <hanawa at sorap.net>.

	* Makefile: Bumped version number to 2.7.

2005-05-10  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (show_usage): Remove an unnecessary parameter
	reported by Kazuhiro NISHIYAMA <zn at mbf.nifty.com>.
	[mobileimap:390] 

2005-03-30  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (be_daemon): Fix the access modes to make it work
	with Ruby 1.9.

2005-03-27  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::generate_message_id): Use #object_id
	instead of id to make it work with Ruby 1.9.

2005-01-10  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 2.6 Released!

2005-01-06  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::get_compact_date): Use
	Time#getlocal. Suggested by Tatsuhiko Miyagawa
	<miyagawa at bulknews.net>

2004-12-15  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in: Support X-JPHONE-UID based on a patch by 
	"YOGI George" <george at yogico.net> [mobileimap:226]
	(check_id): New method.
	(check_request): Use it for checking x-jphone-uid.
	(default_config): New config: jphone_uid.
	(parse_options): New option: --jphone-uid.
	(show_usage): Updated.

	* Makefile: Bumped version number to 2.6.

	* mobileimap.in: Applied Magara-san's patch to handle
	@query.unseen_only appropriately for folder views. [mobileimap:373]
	(ImapWeb::calc_current_fstart): Handle @query.unseen_only flag.
	(ImapWeb::command_summary): Pass @query.unseen_only flag to the
	next pages. 

	* mobileimap.in (ImapWeb::get_compact_date): Fix the format for
	strftime. Reported by Magara Yasuhiro <gama at najira.net>.

2004-08-02  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::generate_url): Introduce :file_name and
	Abolish :path_info for making file name handling more conservative
	for some mobile phone browsers. The modification was originally
	suggested by Jun Morimoto <morimoto at xantia.citroen.org> in an
	IRC discussion about the importance of `unko' parameter in the
	real world. Thanks to his experience.
	(ImapWeb::generate_attachment_links_internal): Adopt the change.

	* ChangeLog: Obfuscate email addresses to prevent spams.

2004-06-09  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 2.5 Released!

	* mobileimap.in (ImapWeb::get_unseen_nmessages): Fixed the bug
	reported by Kazma Sonoda <sonoda at gardenfield.net> [mobileimap:342].
	(ImapWeb::get_body, ImapWeb::get_body): Remove soft line breaks
	for quoted-printable.

2004-02-09  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (parse_options): New option: --debug.
	Patch by akira yamada <akira at arika.org>  [mobileimap:330].
	(Net::IMAP::authenticate2): New method.
	(ImapWeb::validate_authentication): Use it.
	(ImapWeb::process): Ditto.
	(show_usage): Updated.

	* Makefile: Bumped version number to 2.5.

2004-01-27  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (default_config): Make it work with ENV['USER']
	undefined.  Suggested by T.Nikki <nikki at procyon.org> in
	[mobileimap:323]
	(parse_options): Make it work with ENV['HOME'] undefined.
	(default_config): Ditto.

2004-01-26  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 2.4 Released!

	* Makefile (DIST): Add ChangeLog.

	* mobileimap.in (ImapWeb::initialize): Use
	MobileImap::encode_imap_utf7 for  at default_folder and  @fcc_folder
	to fix the bug reported by Takao Kaneko <admin at mitsumine.gr.jp> in
	[mobileimap:316].
	(ImapWeb::generate_url2): Refined.
	(ImapWeb::command_view): Don't preserver seq for "summary" mode.
	(ImapWeb::nth): Be safe.
	(ImapWeb::mail_exist?): New method.
	(ImapWeb::no_such_mail): New method.
	(ImapWeb::command_view): Use them.
	(ImapWeb::calc_current_fstart): Be robust.
	(ImapWeb::get_nmessages_real): New method.
	(ImapWeb::get_nmessages): Use it.
	(ImapWeb::get_messages): Use it.
	(ImapWeb::command_download): Use mail_exist?.
	(ImapWeb::command_header): Ditto.
	(ImapWeb::command_summary): Simplified around generate_navi.
	(ImapWeb::command_folders): Ditto.
	(ImapWeb::command_view): Ditto.
	(ImapWeb::command_view): Don't use emphasize in the method.
	(ImapWeb::generate_body): Use emphasize in the method instead
	(ImapWeb::calc_prev_and_next): New method.
	(ImapWeb::generate_navi): Use it.
	(ImapWeb::initialize): New field: @emphasis_re.
	(ImapWeb::normal_view?): New method.
	(ImapWeb::get_nmessages): Use it.
	(ImapWeb::nth): Ditto.
	(ImapWeb::normal_view?): Ditto.
	(ImapWeb::command_summary): Don't pass unseen_only to folders mode.
	(ImapWeb::command_folders): Accept invalid @query.fstart.
	(ImapWeb::generate_list): Accept invalid @query.start.
	(ImapWeb::generate_seen_mode): Preserve @query.search and
	@query.fsearch. 
	(ImapWeb::no_such_folder): New method.
	(ImapWeb::no_such_something): Ditto.
	(ImapWeb::command_summary): Use no_such_folder.
	(SimpleHtmlGenerator::method_missing): Use escapeHTML.
	(ImapWeb::generate_search_form_common): Don't use escapeHTML in
	the method.
	(ImapWeb::no_such_part): New method.
	(ImapWeb::get_attachment): Use it.
	(ImapWeb::generate_forward_body): Don't use CRLF any longer.
	(ImapWeb::generate_cited_body): Ditto.
	(ImapQuery::non_minus): New method.
	(ImapQuery::max): Use it.
	(ImapWeb::no_such_command): New method.
	(ImapWeb::process): Use it.

	* mobileimap.in (MobileImap::encode_imap_utf7): New method.

	* Makefile: Bumped version number to 2.4.

2004-01-23  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 2.3 Released!

	* mobileimap.in (ImapWeb::generate_url2): New function.
	(ImapWeb::generate_list): Use it.
	(ImapWeb::generate_attachment_links_internal): Ditto.
	(ImapWeb::generate_reply_line): Ditto.
	(ImapWeb::command_view): Ditto.
	(ImapWeb::command_header): Ditto.
	(ImapWeb::generate_new_mail_line): Ditto.
	(ImapWeb::generate_citation_line): Ditto.
	(ImapWeb::command_compose): Ditto.
	(ImapWeb::command_send): Ditto.
	(ImapWeb::generate_search_form_common): Ditto.
	(ImapWeb::command_compose): Fix the return link in forward mode.
	(ImapWeb::generate_url): Omit empty values.
	(ImapQuery::initialize): Remove a field: default_unseen.
	(ImapQuery::unseen_only): Simplified. [mobileimap:308].
	(ImapWeb::initialize): Remove a field: default_unseen.
	(parse_options): Remove an option: --default-unseen.
	(show_usage): Updated.

	* Makefile: Bumped version number to 2.3.

2004-01-22  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 2.2 Released!

	* mobileimap.in (ImapWeb::initialize): Define @date_color.
	Reported by Oskar Bartenstein <oskar at ifcomputer.co.jp>
	[mobileimap:301].
	(HttpServer::nbytes_sent): Avoid warning.

2003-12-28  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::validate_authentication): Call
	IMAP#disconnect after trying authentication.
	Patch by akira yamada <akira at arika.org> [mobileimap:289].
	(ImapWeb::process): Ditto.

2003-12-22  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (be_daemon): Reopen STDIN/STDOUT/STDERR with
	/dev/null instead of closing them.

2003-12-05  OHASHI Akira  <bg66@koka-in.org>

	* mobileimap.in (HttpWriter::print): Add Reason-Phrase to Status-Line.
	[mobileimap:266].

2003-11-21  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::generate_seen_mode): New method.
	(ImapWeb::command_folders): Simplified.
	(ImapWeb::command_summary): Ditto.
	(ImapWeb::command_folders): Add ↑ link.
	(ImapQuery::unseen_only): Simplified.
	(ImapQuery::part): Ditto.
	(ImapQuery::citation): Ditto.
	(ImapQuery::forward): Ditto.
	(ImapQuery::reply): Ditto.
	(ImapWeb::get_messages): Handle @query.unseen_only correctly.
	(ImapWeb::nth): Ditto.

	* Makefile: Bumped version number to 2.2.

2003-11-20  OHASHI Akira  <bg66@koka-in.org>

	* mobileimap.in (parse_options): New option: --default-unseen.
	(show_usage): Ditto.
	(default_config): New config: default_unseen.
	(ImapQuery::initialize): New parameter: default_unseen.
	(ImapQuery::unseen_only): New method.
	(ImapWeb::initialize): New field: @default_unseen.
	(ImapWeb::process): Use it as the parameter for ImapQuery.
	(ImapWeb::command_folders): Use @query.unseen_only and new
	feature: unseen only mode.
	(ImapWeb::command_summary): Ditto.

2003-11-18  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 2.1 Released!

	* mobileimap.in (String::safe_toeuc): Fix LF -> ? bug.
	- Thanks to Oskar Bartenstein <oskar at ifcomputer.co.jp>.

	* Makefile: Bumped version number to 2.1.

2003-10-02  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 2.0 Released!

2003-10-01  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::encode_field): No longer use safe_euc in
	the method.
	(Net::IMAP::new2): New method for backward compatibility for Ruby 1.6.
	[mobileimap:238]
	(ImapWeb::process): Use Net::IMAP::new2 instead of Net::IMAP::new.
	(ImapWeb::validate_authentication): Ditto.
	(ImapWeb::generate_attachment_links_internal): New method.
	(ImapWeb::get_part_structure): New method.
	(ImapWeb::generate_attachment_links): Support a nested multipart
	mail. Thanks to Eiji ENDO <eendo at ff.iij4u.or.jp> for the help.
	[mobileimap:243]
	(ImapWeb::get_body): Ditto.
	(ImapWeb::get_attachment): Ditto.

2003-09-30  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in: Support IMAPS based on Fumihiro Kato
	<fumihiro at sfc.keio.ac.jp>'s patch. [mobileimap:235]
	(ImapWeb::get_body): Fixed a bug reported in [mobileimap:232].
	- Thanks to Eiji ENDO <eendo at ff.iij4u.or.jp> for the report. 
	(ImapWeb::validate_authentication): Use use_ssl flag.
	(ImapWeb::initialize): New field: @use_ssl.
	(ImapWeb::process): Use @use_ssl for authentication.
	(parse_options): New option: --imap-ssl.
	(default_config): New config: :imap_ssl.
	(show_usage): Updated.

2003-09-29  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (SimpleHtmlGenerator::method_missing): Add \n
	before >.
	(String::safe_toeuc): New method.
	(Net::IMAP::fetch_attr): Simplified.
	(String::safe_tosjis): New method.
	(HttpWriter::print): Use safe_tosjis.
	(main): Fix an authentication bug. Ask again if once failed.
	(HttpServer::initialize): Change @timeout from 300
	to 600.
	(ImapWeb::generate_list): Add an error handling [mobileimap:214]
	and [mobileimap:222].

	* Makefile: Bumped version number to 2.0.

2003-09-03  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (HttpServer::initialize): Change @timeout from 30
	to 300.

2003-08-27  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 1.9 Released!

	* mobileimap.in (ImapWeb::generate_from_line): Add "@" mark if a
	mail is an multipart mail.
	(ImapWeb::multipart?): New method.
	(HttpWriter::print): New parameter: additional_header.
	(ImapWeb::get_part_file_name): New method.
	(ImapWeb::get_attachment): Return file_name as well as others.

	* Makefile: Bumped version number to 1.9.

2003-08-22  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 1.8 Released!

	* mobileimap.in (ImapWeb::get_nmessages): Simplified.
	(ImapWeb::command_summary): Ditto.
	(ImapWeb::command_view): Ditto.
	(ImapWeb::get_messages): Don't search if not necessary.
	Fix the bug reported by T.Nikki <nikki at procyon.org> [mobileimap:204]

	* Makefile: Bumped version number to 1.8.

2003-08-20  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 1.7 Released!

	* mobileimap.in (ImapWeb::generate_meta): Don't do Cache-Control.
	(ImapWeb::initialize): Remove a field: @cache_control.
	(show_usage): Updated.

	* mobileimap.in (parse_options): Remove an option --cache-control.

	* mobileimap.in (ImapWeb::generate_attachment_links): Remove the
	following two conditions. [mobileimap:188]
	next unless part.is_a?(Net::IMAP::BodyTypeBasic)
        next unless part.encoding == "BASE64"
	(SimpleHtmlGenerator::method_missing): Use " instead of '.

	* mobileimap.in (ImapQuery::search): New method.
	(ImapWeb::get_messages): New method.
	(ImapWeb::get_nmessages): Use get_messages.
	(ImapWeb::get_unseen_nmessages): Ditto.
	(ImapWeb::generate_list): Ditto.
	(ImapWeb::generate_fsearch_form): Renamed from fsearch_form.
	(ImapWeb::generate_search_form): New method.
	(ImapWeb::generate_list): Preserve @query.search for command_view.
	(ImapWeb::emphasize): New method.
	(ImapWeb::generate_url): Use NKF.
	(ImapWeb::generate_from_line): Use emphasize.
	(ImapWeb::generate_list): Ditto.
	(ImapWeb::command_view): Ditto.
	(ImapWeb::nth): New method.
	(ImapWeb::generate_mark_and_number): Use nth.
	(ImapWeb::calc_current_start): Ditto.
	(String::escapeURL): Use CGI module.
	(String::unescapeURL): Ditto.
	(String::escapeHTML): Ditto.

	* Makefile: Bumped version number to 1.7.

2003-08-19  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (show_usage): Updated.
	(default_config): New config :allow_hosts.
	(parse_options): New option: --allow-hosts
	(HttpServer::validate_access): New method.
	(HttpServer::initialize): New parameter: allow_hosts.
	(HttpsServer::initialize): Ditto.
	(start_server): Pass config[:allow_hosts] to Https?Server.new
	(HttpServer::process_session): Use validate_access.
	(ImapWeb::fsearch_form): New method.
	(ImapWeb::command_folders): Use fsearch_form.
	(ImapQuery::fsearch): New method.
	(ImapWeb::get_folders): Use @query.fsearch to filter the list.
	(ImapWeb::get_folders): Be ignorecase.

2003-08-18  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (RequestError): New class.
	(start_server): Don't show a backtrace for RequestError.
	(Exception::to_html_simple): New method.
	(Exception::to_html): Refined.

2003-08-17  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (MobileImap::decode_imap_utf7): Catch any type of
	exceptions. 
	(ImapWeb::add_in_reply_to_and_references): Refine the conditions
	to avoid an error occurred when message_id or references is nil.

2003-07-31  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 1.6 Released!

	* mobileimap.in (ask_password): Call stty only if STDIN is a tty.
	(stop_servers): Add an additional parameter: urls
	(parse_options): Call stop_servers and list_servers in the method.
	(main): Don't call stop_servers and list_servers in the method.
	(main): Call ask_password only if config[:imap_password] is nil.
	(parse_options): New option: --dump-config.
	(dump_config): New method.
	(ImapWeb::initialize): New parameter: base_url.
	(parse_options): New option: --mobileimaprc.
	(read_config): New method.

	* Makefile: Bumped version number to 1.6.

2003-06-17  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 1.5 Released!

	* mobileimap.in: require 'thwait' to use ThreadsWait.
	(HttpServer::start): Use timeout.
	(HttpServer::remote_host): New method.
	(Logger::vlog): New method.
	(parse_options): New option: --verbose.
	(show_usage): Updated.

	* Makefile: Bumped version number to 1.5.

2003-06-13  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::generate_attachment_links): Get a file
	name using part.disposition info as well as part.param.

2003-06-11  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (HttpServer::start): rescue URI::InvalidURIError.
	(ImapQuery::vars): Removed.

2003-05-28  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 1.4 Released!

	* mobileimap.in (MobileImap::decode_imap_utf7): Don't raise an
	exception if Iconv.new("euc-jp", "utf-8") doesn't work.
	[mobileimap:147]

	* mobileimap.in (MobileImap::decode_imap_utf7): Fix the bug
	occurred when Net::IMAP::decode_utf7 is not defined.  Thanks to
	"T. Kurasawa" <kurasan at shiraume.ac.jp> for the report.
	[mobileimap:140]

	* Makefile: Bumped version number to 1.4.

2003-05-27  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (Logger::initialize): Remove an unused parameter.

2003-05-26  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 1.3 Released!

	* Makefile: Bumped version number to 1.3.

2003-05-19  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::generate_attachment_links): New method.
	(ImapQuery::part): New method.
	(ImapWeb::command_download): New method.
	(ImapWeb::get_attachment): New method.
	(ImapWeb::get_body): Take an optional argument: part.
	(HttpWriter::print): Take an optional argument: content_type.
	(ImapWeb::generate_url): Handle :path_info.
	(check_request): Allow PATH_INFO added URL.

2003-05-13  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (MobileImap::decode_imap_utf7): Define this method
	even if Iconv orNet::IMAP::decode_utf7 is not available.
	(ImapWeb::get_folders): Use MobileImap::decode_imap_utf7 before
	applying include/exclude regexes.

2003-05-12  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 1.2 Released!

	* mobileimap.in (MobileImap::decode_imap_utf7): Use
	Net::IMAP::decode_utf7
	(ImapQuery::to): Use NKF.nkf.
	(ImapQuery::cc): Ditto.
	(ImapQuery::subject): Ditto.
	(ImapQuery::from): Ditto.
	(ImapQuery::body): Ditto.

	* Makefile: Bumped version number to 1.2.

2003-05-09  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::create_message): Use NKF.nkf('-SjX')
	instead of String#tojis to convert so-called hankaku-kana to
	zenkaku-kana. 
	- Thanks to Eiji ENDO <eendo at ff.iij4u.or.jp> for the suggestion. 
	[mobileimap:127]

	* mobileimap: 1.1 Released!

	* mobileimap.in (MobileImap::decode_imap_utf7): New method.
	(ImapWeb::simplify_folder_name): Use decode_imap_utf7 if available.
	(ImapWeb::command_folders): Use <tt>
	
	* Makefile: Bumped version number to 1.1.

2003-05-07  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 1.0 Released!

2003-05-06  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (HttpServer::parse_header): Support an empty
	request.
	(parse_options): New option: --ssl.
	(HttpServer::accept): New method.
	(HttpsServer): New class.
	(HttpsServer::accept): New method.
	(HttpsServer::close_socket): New method.
	(parse_options): New option: --ssl-key, --ssl-cert
	(default_config): Add default values of :support_ssl_p,
	:ssl_key_file_name, and :ssl_cert_file_name.
	(show_usage): Updated.

	* mobileimap.in: Apply akira yamada's patch. [mobileimap:102]
	(OpenSSL::SSL::SSLSocket::peer_address): New method.
	(OpenSSL::SSL::SSLSocket::peer_hostname): Ditto.

	* mobileimap.in (start_server): Refine signal handling. no longer
	using trap { ...}. Thanks to akira yamada <akira at arika.org> for
	the patch. [mobileimap:115]

2003-05-05  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (HttpWriter::print): Call out.finish only if out
	responds to :finish. Thanks to 	TADA Tadashi <sho at spc.gr.jp> for
	the report. [mobileimap:117]

2003-05-02  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (Zlib::required_version?): New method.
	(ImapWeb::generate_navi): Do not insert a space into left/right
	arrows to save the space.

2003-05-01  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::generate_new_mail_line): New method.
	(ImapWeb::command_summary): Use generate_new_mail_line.
	(ImapWeb::command_folders): Add top/bottom arrows.
	- Thanks to Eiji ENDO <eendo at ff.iij4u.or.jp> for the suggestion. 
	[mobileimap:106]
	(ImapWeb::command_summary): Ditto.
	(ImapWeb::create_message): Add HTTP User-Agent to X-Mailer field.

2003-04-30  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in: Apply akira yamada's patch [mobileimap:101]
	(HttpWriter::print, HttpWriter::print):
	s/GzipWriter/Zlib::GzipWriter/ and call	Zlib::GzipWriter#finish.
	(ImapWeb::command_view): Use <div>.
	(ImapWeb::command_header): Ditto.
	(ImapWeb::command_summary): Ditto.
	(ImapWeb::command_compose): Ditto.
	(ImapWeb::command_folders): Ditto.
	(SimpleHtmlGenerator::method_missing): Add / to the end of single
	element such as <meta ... />
	(HttpWriter::print): Add "Conection: close" to the response header.

	* Makefile: Bumped version number to 1.0.

2003-04-28  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 0.9 Released!

	* mobileimap.in (ImapQuery::forward): New method.
	(ImapWeb::command_forward): Removed.
	(ImapWeb::command_compose): Integrate forwarding function.

2003-04-27  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::command_compose): Change <title>
	according to @query.reply.
	(ImapWeb::generate_citation_text): Use esscapeHTML.
	(ImapWeb::command_forward): New method.
	(ImapWeb::command_view): Add a new link to do mail forwarding.
	(ImapWeb::get_to_address): New method.
	(ImapWeb::generate_cited_body): Renamed from generate_citation_text.
	(ImapQuery::body): Renamed from text.

2003-04-24  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (be_daemon): Close STDERR.
	- Thanks to Masaru Yokoi <masaru at masaruyokoi.com> for tha patch.
	[mobileimap:95]

2003-04-23  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (HttpServer::parse_query_internal): Use symbol for
	keys of query variables.
	(ImapQuery::command): Ditto.
	(ImapQuery::folder): Ditto.
	(ImapQuery::start): Ditto.
	(ImapQuery::fstart): Ditto.
	(ImapQuery::max): Ditto.
	(ImapQuery::seq): Ditto.
	(ImapQuery::citation): Ditto.
	(ImapQuery::to): Ditto.
	(ImapQuery::cc): Ditto.
	(ImapQuery::subject): Ditto.
	(ImapQuery::from): Ditto.
	(ImapQuery::text): Ditto.
	(ImapQuery::disposable_var?): Ditto.
	(ImapWeb::compact_subject): Use String#cut.
	(ImapQuery::defined?): New method.
	(ImapQuery::seq): Set the default value to 1.
	(ImapWeb::calc_current_fstart): New method.
	(ImapWeb::command_summary): Use calc_current_fstart.
	(ImapWeb::get_folders): Fix the duplicated "INBOX" bug.
	(ImapWeb::command_folders): Fix the folder list bug.
	(ImapWeb::calc_current_start): New method.
	(ImapWeb::command_view): Use calc_current_start.
	(ImapQuery::reply): New method.
	(ImapQuery::defined?): Removed.
	(ImapWeb::generate_url): Change the parameters.
	(ImapWeb::generate_list): Change the use of generate_list.
	(ImapWeb::generate_navi): Ditto.
	(ImapWeb::generate_reply_line): Ditto.
	(ImapWeb::link_ml_folder): Ditto.
	(ImapWeb::command_view): Ditto.
	(ImapWeb::command_header): Ditto.
	(ImapWeb::command_summary): Ditto.
	(ImapWeb::generate_citation_line): Ditto.
	(ImapWeb::command_compose): Ditto.
	(ImapWeb::command_send): Ditto.
	(ImapWeb::command_folders): Ditto.
	(ImapQuery::disposable_var?): Removed.
	(ImapWeb::link_ml_folder): Refined.
	(ImapWeb::initialize): New field: @envelope_cache.
	(ImapWeb::get_field): Use @envelope_cache.
	(ImapWeb::nbsp): Convert a space at the beginning of a line to &nbsp;
	(check_request): Check the Host: field in the requrest header.
	- Thanks to Masao SAITO <masao at saito.jp> for the suggestion.
	[mobileimap:91]

	* Makefile: Bumped version number to 0.9.

2003-04-22  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::link_ml_folder): New method.
	- Thanks to Toshiyuki Masui <masui at pitecan.com> for the suggestion.
	(ImapWeb::ML_PREFIX_REGEX): New constant.
	(ImapWeb::compact_subject): Use ML_PREFIX_REGEX.
	(ImapQuery::fstart): New method.
	(ImapWeb::command_summary): Use ImapQuery#fstart.
	(ImapQuery::vars): New method.
	(ImapWeb::generate_url): Use ImapQuery#vars.
	(ImapWeb::generate_list): Simplify the arguments of generate_url.
	(ImapWeb::generate_navi): Ditto.
	(ImapWeb::command_view): Ditto.
	(ImapWeb::command_summary): Ditto.
	(ImapWeb::command_header): Ditto.
	(ImapWeb::generate_citation_line): Ditto.
	(ImapWeb::command_compose): Ditto.
	(ImapWeb::command_send): Ditto.
	(ImapQuery::post_keys): New method.
	(ImapQuery::fstart): New method.
	(ImapWeb::command_folders): Use ImapQuery::fstart.

	* mobileimap: 0.8 Released!

2003-04-21  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (HttpServer::customize_socket): New method.
	(IO::write): Removed.
	(IO::nbytes_written): Removed.

2003-04-20  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in: (read_pid_file): Support the old format lacking URLs.
	(default_config): New config parameter: :stop_urls.
	(stop_servers): Renamed from stop_server.
	(HttpServer::initialize): Remove a field: @service_uri.
	(show_version): Remove :.
	(HttpWriter::initialize): Take a new parameter called logger.
	(HttpWriter::print): Remove a parameter called out.
	(IO::write): New method.
	(IO::nbytes_written): New method.
	(HttpServer::start): Modify the log message to report n bytes sent.

	* mobileimap.in: Apply akira yamada's patch to support --stop=URIs
	and --list options. [mobileimap:81] 
	(update_pid_file): New method
	(HttpServer::initialize): New field: service_uri.
	(parse_options): New option: --list and --stop accepts optional
	argument to specify URLs to kill. 
	(read_pid_file): Collect URLs in the pid file as well as PIDs.
	(list_servers): New method.
	(stop_servers): Takes an optional parameter to specify URLs to kill.
	(be_daemon): New parameter to specify the service URL.
	(main): Add codes around stop_server.

2003-04-19  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 0.7 Released!

	* mobileimap.in (ImapWeb::generate_body): Refined.
	(ImapWeb::configure): Multiple 10 times for PC web browsers.
	(String::untabify): New method.
	(ImapWeb::nbsp): Use String#untabify. Use &nbsp; only if two or
	more spaces are continued.
	(ImapWeb::nbsp): Use zenkaku-space instead of &nbsp;
	(ImapWeb::command_header): Save the number of g.tt.
	(ImapWeb::command_header): Ditto.
	(ImapWeb::generate_navi): Use <- -> links to go to the other side
	of the list.
	(ImapWeb::get_body): Support base64 and quoted-printable.

	* Makefile: Bumped version number to 0.8.

2003-04-18  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::generate_message_id): New method.
	(ImapWeb::create_message): Use generate_message_id and fix the
	Message-ID bug.
	(ImapWeb::get_field): Use "BODY[HEADER.FIELDS (...)]" if the envelope
	doesn't respond to the specified field name.
	(ImapWeb::create_message): Add In-Reply-To: and References: handling.
	- Thanks to Eiji ENDO <eendo at ff.iij4u.or.jp> for the suggestion. 
	[mobileimap:76]
	(stop_server): Add a message for no proccesses are killed.
	(ImapWeb::generate_footer): Add g.hr

	* Makefile: Bumped version number to 0.7.

	* mobileimap: 0.6 Released!

2003-04-17  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::configure): Add AirH" handling.
	- Thanks to masakazu at yamada.gr.jp (Masakazu Yamada) for the patch.
	[mobileimap:61]
	(show_usage): New option: --client-width
	(ImapWeb::configure): Add ktai web browsers handling. KDDI, DoComo...
	(ImapWeb::command_compose): Fix the new mail bug.
	(ImapWeb::generate_meta): New method.
	(ImapWeb::command_folders): Use generate_meta.
	(ImapWeb::command_compose): Ditto.
	(ImapWeb::command_summary): Ditto.
	(ImapWeb::command_header): Ditto.
	(ImapWeb::command_view): Ditto.
	(show_usage): Updated.
	(HttpWriter::print): Add Last-Modified: field.
	(HttpWriter::print): Add Expires: field.
	- Thanks to akira yamada <akira at arika.org> for the suggestion.
	[mobileimap:65]
	(HttpServer::start): Show User-Agent for log messages.
	(parse_options): New option --cache-control.
	- Thanks to masakazu at yamada.gr.jp (Masakazu Yamada) for the
	suggestion. [mobileimap:63]
	(ImapWeb::send_mail): Apply Masakazu Yamada's patch [mobileimap:67]
	(ImapWeb::ADDRESS_REGEX): be a constant from @address_regex.
	(ImapWeb::command_compose): Fix the return link bug.
	- Thanks to Eiji ENDO <eendo at ff.iij4u.or.jp> for the report. 
	[mobileimap:72]
	(default_config): New method.
	(pf): New method.
	(ImapWeb::collect_addresses): Use Regexp.match instead of =~
	(Regexp::to_s2): New method.
	(show_usage): Refined using default_config.
	(set_config): New method.
	(parse_options): Refined using default_config and set_config.
	(ImapWeb::generate_body): Apply s/ /&nbsp;/g.
	(ImapWeb::command_header): Ditto.
	(ImapWeb::nbsp): New method.
	(ImapWeb::generate_body): Refined using nbsp & <tt>.
	(ImapWeb::command_header): Ditto.

	* Makefile: Bumped version number to 0.6.

2003-04-16  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (start_server): Sleep 1 before retry

	* mobileimap: 0.5 Released!

	* mobileimap.in (ImapWeb::get_name): Remove surrounding
	double-quotations.
	(ImapQuery::citation): New method.
	(ImapWeb::command_compose): Add a citation link.
	(ImapWeb::generate_citation_line): New method.
	(ImapWeb::generate_citation_text): New method.
	(HttpServer::parse_header): Fix the header parsing bug.
	(ImapWeb::get_client_width): Support PC web browsers.
	(ImapWeb::command_view): Add links to top/bottom.
	(ImapWeb::configure): New method.
	(ImapWeb::get_client_width): Removed.

2003-04-15  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (HttpWriter): New class.
	(HttpWriter::enable_gzip): New method.
	(HttpWriter::enable_x_gzip): New method.
	(HttpWriter::print): New method.
	(header_contains?): New method.
	(x_gzip_acceptable?): New method.
	(ImapWeb::initialize): New field: @writer.
	(Http::print): Removed.
	(ImapWeb::generate_footer): Show (gzip) if the output is encoded
	in gzip.
	(ImapWeb::command_compose): Add footer.
	(ImapWeb::command_view): Ditto.
	(ImapWeb::command_header): Ditto.
	(ImapWeb::command_folders): Ditto.
	(ImapWeb::command_folders): Use @seq_color.
	(ImapWeb::generate_mailto_url): Remove require 'cgi' why is it
	inserted in here??
	(ImapWeb::command_folders): Show "*" for folders having unseen
	messages. Thanks to Eiji ENDO <eendo at ff.iij4u.or.jp> for the
	suggestion. [mobileimap:53]
	(ImapWeb::get_unseen_nmessages): Take one parameter.
	(ImapWeb::get_nmessages): Ditto.
	Apply akira yamada's patch [mobileimap:56] for avoiding warnings by
	ruby 1.8.

	* Makefile: Bumped version number to 0.5.

2003-04-14  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ask_password): Ensure doing "stty echo".
	- Thanks to Kazuhiro NISHIYAMA <zn at mbf.nifty.com> for the patch.
	[mobileimap:48]
	(ask_password): Don't print error messages if interrupted.
	(check_request): Allow an extra "/" at the end of URL for those
	who accidentally add "/" to the end of URL.

2003-04-13  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap: 0.4 Released!

	* mobileimap.in (ImapWeb::generate_mailto_url): Fix the @->%40
	bug. Thanks to Eiji ENDO <eendo at ff.iij4u.or.jp> for the report.
	[mobileimap:44]

	* Makefile: Bumped version number to 0.4.

2003-04-11  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ImapWeb::get_from_name): Fix the empty name bug.
	(ImapWeb::simplify_folder_name): Snip @default_folder_prefix.
	(String::escapeURL): Fix the Shift_JIS handling bug.
	(ImapWeb::command_send): Suport Fcc.
	(parse_options): New option --fcc-folder
	(show_usage): Updated.
	(ImapWeb::validate_authentication): New method.
	(main): Use ImapWeb.validate_authentication to valid the password.
	(start_server): Be multi-thread safe.
	(ImapWeb::add_link): Support +81- notation.
	(Exception::to_html): New method.
	(ImapWeb::command_send): Use Exception#to_html to report errors.
	(start_server): Ditto.

	* mobileimap: 0.3 Released!

	* mobileimap.in (ImapWeb::generate_list): Don't save/restore flags.
	(Net::IMAP::fetch_flags): Removed.
	(Net::IMAP::store_flags): Removed.
	(ImapWeb::get_address): New method.
	(ImapWeb::get_from_name): Renamed from get_from_full_name.
	(ImapWeb::get_name): New method.
	(ImapWeb::get_field): Use "ENVELOPE" instead of "BODY"
	- Thanks to akira yamada <akira at arika.org> for the suggestion.
	[mobileimap:40]
	(ImapWeb::get_from_address): Simplified.
	(ImapWeb::get_to_address): Ditto.
	(ImapWeb::get_reply_to_address): Ditto.
	(ImapWeb::get_from_name): Ditto.

	* mobileimap.in (ImapWeb::send_mail): Fix the recipients bug.

	* mobileimap.in (HttpServer::parse_query): Fix the POST method bug.

	* images/summary.png: New file.

	* images/view.png: New file.

	* images/folders.png: New file.

	* images/compose.png: New file.

	* mobileimap.in (Net::IMAP::fetch_flags): New method.
	(Net::IMAP::store_flags): New method.
	(ImapWeb::command_summary): Use @imap.select instead of examine
	to make uw-imapd fetch new mails to INBOX. [mobileimap:33]
	(ImapWeb::generate_list): Restore flags after generating a summary.
	(parse_options): New option: --folder-prefix.
	(show_usage): Update messages.
	(ImapWeb::get_folders): Use @default_folder_prefix
	(ImapWeb::get_folders): Add INBOX to the top

2003-04-10  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (parse_options): New option: --folder, --subscribed.
	(ImapQuery::initialize): New parameter: default_folder.
	(ImapQuery::folder): Use @default_folder if necessary.
	(ImapWeb::command_header): Call @imap.examine instead of select.
	(ImapWeb::command_summary): Ditto.
	(ImapWeb::command_compose): Ditto.

2003-04-09  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ensure_not_already_started): Removed.
	(Process::exist?): Removed.
	(read_pid_file): Return Array.
	(be_daemon): PID file can be appended.
	(stop_server): Kill all processes recorded in the PID file.
	(String::escapeURL): Rewritten.
	(String::unescapeURL): Ditto.
	(ImapWeb::command_view): Use @imap.select instead of @imap.examine
	to support cyrus-imapd (examine is for read-only mode).
	- Thanks to Daisuke Higashi <dais at bonz.squares.net> for the patch.
	(ImapWeb::command_header): Ditto.
	(ImapWeb::command_summary): Ditto.
	(ImapWeb::command_compose): Ditto.
	(ImapWeb::get_subject): Fix the empty subject bug.
	(Process::exist?): New method.
	(read_pid_file): Return [] if PID file is not found.
	(write_pid_file): New method.
	(ImapWeb::command_header): Add a link to "view" mode. Thanks to
	TADA Tadashi <sho at spc.gr.jp> for the patch. [mobileimap:22]
	(ImapWeb::command_header): Not to use <pre> to avoid the rendering
	problem with ezweb.
	(ImapWeb::get_folders): s/:NoSelect/:Noselect/
	(ImapWeb::generate_navi): Generalized.
	(ImapWeb::command_view): Add the navigation bar to next/prev messages.
	- Thanks to TADA Tadashi <sho at spc.gr.jp> for the suggestion.
	(ImapQuery::start): Be 1-base to be compatible with seq.

	* Makefile: Bumped version number to 0.3.

2003-04-08  Satoru Takabayashi  <satoru@namazu.org>

	* mobileimap.in (ensure_not_already_started): New method.
	(read_pid_file): New method.
	(Process::exist?): New method.
	(main): Call ensure_not_already_started.

	* mobileimap: 0.2 Released!

	* mobileimap.in (ImapWeb::add_link): Fix the regex for telephone
	numbers. Thanks to TADA Tadashi <sho at spc.gr.jp> for the patch.
	[mobileimap:9]
	(String::xchomp): Refined.
	(ImapWeb::compact_subject): Refine the regex.
	(TCPSocket::peer_hostname): New method.
	(TCPSocket::peer_address): New method.
	(ImapWeb::add_link): Fix mailto: s/@/%40/ bug.
	(HttpServer::start): Add log messages.
	(Net::IMAP::seen?): New method.
	(Net::IMAP::mark_seen): New method.
	(ImapWeb::command_view): Call @imap.mark_seen.
	(ImapWeb::generate_date_line): Change the square mark using imap.seen?
	(stop_server): New method contributed by akira yamada <akira at arika.org>
	(parse_options): New option -k, --stop.
	(Logger::reopen): New method.
	(start_server): Add trap(:HUP) to reopen the log file.
	(start_server): chmod 600 to log_file.
	(ImapWeb::generate_url): Make a relative URL not absolute one.
	(parse_options): Apply String#to_i to all --*-port options.
	(parse_options): Fix --smtp-port bug.

	* Makefile: Bumped version number to 0.2.

	* mobileimap: 0.1 Released!

2003-04-05  Satoru Takabayashi  <satoru@namazu.org>

	* The first working version.

2003-04-02  Satoru Takabayashi  <satoru@namazu.org>

	* Development started!


